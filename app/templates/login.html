
{% extends "base.html" %}

{% block title %}Đăng nhập - Achievo{% endblock %}

{% block content %}
<div style="max-width: 400px; margin: 2rem auto;">
    <div class="card">
        <h2 style="text-align: center; margin-bottom: 2rem;">Đăng nhập</h2>
        
        <form method="POST">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="password">Mật khẩu:</label>
                <input type="password" id="password" name="password" class="form-control" required>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">Đăng nhập</button>
        </form>
        
        <div style="text-align: center; margin-top: 1rem;">
            <p>Chưa có tài khoản? <a href="{{ url_for('register') }}">Đăng ký ngay</a></p>
        </div>
        
        <hr style="margin: 2rem 0;">
        
        <div style="text-align: center;">
            <button onclick="connectCardanoWallet()" class="btn btn-success" style="width: 100%;">
                Đăng nhập bằng Cardano Wallet
            </button>
        </div>
    </div>
</div>

<script>
async function connectCardanoWallet() {
    try {
        if (!window.cardano) {
            alert('Vui lòng cài đặt Cardano wallet (Nami, Eternl, Flint)');
            return;
        }
        
        const api = await window.cardano.nami.enable();
        const addresses = await api.getUsedAddresses();
        
        if (addresses.length > 0) {
            // Send wallet address to backend for authentication
            const response = await fetch('/auth/wallet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    address: addresses[0]
                })
            });
            
            if (response.ok) {
                window.location.href = '/dashboard';
            } else {
                alert('Xác thực wallet thất bại');
            }
        }
    } catch (error) {
        console.error('Wallet connection error:', error);
        alert('Kết nối wallet thất bại');
    }
}
</script>
{% endblock %}
